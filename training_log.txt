Sliding Window Attention is enabled but not implemented for `sdpa`; unexpected results may be encountered.
/home/jota/.local/lib/python3.10/site-packages/awq/__init__.py:21: DeprecationWarning: 
I have left this message as the final dev message to help you transition.

Important Notice:
- AutoAWQ is officially deprecated and will no longer be maintained.
- The last tested configuration used Torch 2.6.0 and Transformers 4.51.3.
- If future versions of Transformers break AutoAWQ compatibility, please report the issue to the Transformers project.

Alternative:
- AutoAWQ has been adopted by the vLLM Project: https://github.com/vllm-project/llm-compressor

For further inquiries, feel free to reach out:
- X: https://x.com/casper_hansen_
- LinkedIn: https://www.linkedin.com/in/casper-hansen-804005170/

  warnings.warn(_FINAL_DEV_MESSAGE, category=DeprecationWarning, stacklevel=1)
================================================================================
🚀 TREINAMENTO LoRA - UNIMED NATAL
================================================================================
🏥 Cliente: UNIMED NATAL
📊 Dataset: 100.000+ conversas realistas de atendimento médico
🎯 Objetivo: Atendente virtual especializado Unimed
⏰ Início: 2025-10-30 15:49:50
🖥️  GPUs: 0 e 1 (2x Quadro RTX 6000)
💾 Memória liberada: ~40GB VRAM disponível
🔧 Técnica: LoRA (Low-Rank Adaptation)
📦 Modelo base: Qwen2.5-32B-Instruct (4-bit)
================================================================================

🤖 Configurando modelo e tokenizer...
  📥 Carregando tokenizer...
  📥 Carregando modelo Qwen 32B AWQ (já quantizado)...
  ⏳ Isso pode levar 2-3 minutos...
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|██        | 1/5 [00:00<00:03,  1.07it/s]Loading checkpoint shards:  40%|████      | 2/5 [00:01<00:02,  1.06it/s]Loading checkpoint shards:  60%|██████    | 3/5 [00:02<00:01,  1.03it/s]Loading checkpoint shards:  80%|████████  | 4/5 [00:03<00:00,  1.03it/s]Loading checkpoint shards: 100%|██████████| 5/5 [00:04<00:00,  1.13it/s]Loading checkpoint shards: 100%|██████████| 5/5 [00:04<00:00,  1.09it/s]
  ✅ Modelo carregado com sucesso!

⚙️  Configurando LoRA para Unimed...
  📊 Parâmetros treináveis: 268,435,456 (14.70%)
  📊 Total de parâmetros: 1,826,231,296
  💾 Tamanho estimado do LoRA: ~512MB

📂 Carregando dataset Unimed...
  Carregando conversas:   0%|          | 0/100000 [00:00<?, ?it/s]  Carregando conversas:  15%|█▍        | 14597/100000 [00:00<00:01, 50080.86it/s]  Carregando conversas:  33%|███▎      | 32774/100000 [00:00<00:00, 93394.01it/s]  Carregando conversas:  51%|█████▏    | 51268/100000 [00:00<00:00, 122655.58it/s]  Carregando conversas:  70%|██████▉   | 69626/100000 [00:00<00:00, 141750.10it/s]  Carregando conversas:  86%|████████▌ | 86178/100000 [00:00<00:00, 89170.47it/s]   Carregando conversas: 100%|██████████| 100000/100000 [00:00<00:00, 101673.29it/s]
  ✅ 100,000 conversas carregadas
  📊 Com tool calls: 35,000 (35.0%)

🔧 Preparando dados para treinamento...
  Tokenizando:   0%|          | 0/100000 [00:00<?, ?it/s]  Tokenizando:   1%|          | 651/100000 [00:00<00:15, 6507.77it/s]  Tokenizando:   1%|▏         | 1315/100000 [00:00<00:15, 6572.57it/s]  Tokenizando:   2%|▏         | 1973/100000 [00:00<00:15, 6533.98it/s]  Tokenizando:   3%|▎         | 2648/100000 [00:00<00:14, 6616.54it/s]  Tokenizando:   3%|▎         | 3310/100000 [00:00<00:14, 6606.71it/s]  Tokenizando:   4%|▍         | 3971/100000 [00:00<00:14, 6561.15it/s]  Tokenizando:   5%|▍         | 4628/100000 [00:00<00:14, 6538.87it/s]  Tokenizando:   5%|▌         | 5300/100000 [00:00<00:14, 6592.49it/s]  Tokenizando:   6%|▌         | 5960/100000 [00:00<00:14, 6546.38it/s]  Tokenizando:   7%|▋         | 6649/100000 [00:01<00:14, 6649.91it/s]  Tokenizando:   7%|▋         | 7315/100000 [00:01<00:14, 6496.64it/s]  Tokenizando:   8%|▊         | 7969/100000 [00:01<00:14, 6508.50it/s]  Tokenizando:   9%|▊         | 8624/100000 [00:01<00:14, 6516.65it/s]  Tokenizando:   9%|▉         | 9285/100000 [00:01<00:13, 6539.69it/s]  Tokenizando:  10%|▉         | 9942/100000 [00:01<00:13, 6547.35it/s]  Tokenizando:  11%|█         | 10597/100000 [00:01<00:13, 6502.04it/s]  Tokenizando:  11%|█▏        | 11263/100000 [00:01<00:13, 6548.10it/s]  Tokenizando:  12%|█▏        | 11950/100000 [00:01<00:13, 6641.57it/s]  Tokenizando:  13%|█▎        | 12615/100000 [00:01<00:13, 6540.98it/s]  Tokenizando:  13%|█▎        | 13270/100000 [00:02<00:13, 6527.26it/s]  Tokenizando:  14%|█▍        | 13924/100000 [00:02<00:13, 6446.46it/s]  Tokenizando:  15%|█▍        | 14571/100000 [00:02<00:13, 6453.14it/s]  Tokenizando:  15%|█▌        | 15217/100000 [00:02<00:13, 6452.74it/s]  Tokenizando:  16%|█▌        | 15863/100000 [00:02<00:13, 6361.15it/s]  Tokenizando:  16%|█▋        | 16500/100000 [00:02<00:16, 5008.97it/s]  Tokenizando:  17%|█▋        | 17046/100000 [00:02<00:18, 4441.47it/s]  Tokenizando:  18%|█▊        | 17530/100000 [00:02<00:18, 4404.28it/s]  Tokenizando:  18%|█▊        | 18151/100000 [00:03<00:16, 4848.43it/s]  Tokenizando:  19%|█▉        | 18780/100000 [00:03<00:15, 5220.61it/s]  Tokenizando:  19%|█▉        | 19431/100000 [00:03<00:14, 5567.35it/s]  Tokenizando:  20%|██        | 20088/100000 [00:03<00:13, 5843.49it/s]  Tokenizando:  21%|██        | 20744/100000 [00:03<00:13, 6044.37it/s]  Tokenizando:  21%|██▏       | 21415/100000 [00:03<00:12, 6235.86it/s]  Tokenizando:  22%|██▏       | 22049/100000 [00:03<00:25, 3003.70it/s]  Tokenizando:  23%|██▎       | 22687/100000 [00:04<00:21, 3566.44it/s]  Tokenizando:  23%|██▎       | 23318/100000 [00:04<00:18, 4092.82it/s]  Tokenizando:  24%|██▍       | 23963/100000 [00:04<00:16, 4600.41it/s]  Tokenizando:  25%|██▍       | 24599/100000 [00:04<00:15, 5014.02it/s]  Tokenizando:  25%|██▌       | 25259/100000 [00:04<00:13, 5412.56it/s]  Tokenizando:  26%|██▌       | 25888/100000 [00:04<00:13, 5641.62it/s]  Tokenizando:  27%|██▋       | 26536/100000 [00:04<00:12, 5870.03it/s]  Tokenizando:  27%|██▋       | 27190/100000 [00:04<00:12, 6057.42it/s]  Tokenizando:  28%|██▊       | 27841/100000 [00:04<00:11, 6185.08it/s]  Tokenizando:  29%|██▊       | 28505/100000 [00:04<00:11, 6315.79it/s]  Tokenizando:  29%|██▉       | 29153/100000 [00:05<00:11, 6348.41it/s]  Tokenizando:  30%|██▉       | 29839/100000 [00:05<00:10, 6499.04it/s]  Tokenizando:  30%|███       | 30497/100000 [00:05<00:10, 6517.65it/s]  Tokenizando:  31%|███       | 31167/100000 [00:05<00:10, 6568.86it/s]  Tokenizando:  32%|███▏      | 31828/100000 [00:05<00:10, 6518.71it/s]  Tokenizando:  32%|███▏      | 32483/100000 [00:05<00:10, 6450.21it/s]  Tokenizando:  33%|███▎      | 33131/100000 [00:05<00:10, 6412.78it/s]  Tokenizando:  34%|███▍      | 33787/100000 [00:05<00:10, 6455.24it/s]  Tokenizando:  34%|███▍      | 34434/100000 [00:05<00:10, 6426.96it/s]  Tokenizando:  35%|███▌      | 35093/100000 [00:05<00:10, 6473.41it/s]  Tokenizando:  36%|███▌      | 35752/100000 [00:06<00:09, 6506.49it/s]  Tokenizando:  36%|███▋      | 36404/100000 [00:06<00:09, 6480.13it/s]  Tokenizando:  37%|███▋      | 37053/100000 [00:06<00:09, 6450.81it/s]  Tokenizando:  38%|███▊      | 37706/100000 [00:06<00:09, 6474.11it/s]  Tokenizando:  38%|███▊      | 38354/100000 [00:06<00:09, 6459.59it/s]  Tokenizando:  39%|███▉      | 39005/100000 [00:06<00:09, 6470.91it/s]  Tokenizando:  40%|███▉      | 39653/100000 [00:06<00:09, 6466.56it/s]  Tokenizando:  40%|████      | 40311/100000 [00:06<00:09, 6500.13it/s]  Tokenizando:  41%|████      | 40962/100000 [00:06<00:09, 6432.69it/s]  Tokenizando:  42%|████▏     | 41624/100000 [00:06<00:08, 6487.75it/s]  Tokenizando:  42%|████▏     | 42273/100000 [00:07<00:08, 6419.99it/s]  Tokenizando:  43%|████▎     | 42935/100000 [00:07<00:08, 6478.34it/s]  Tokenizando:  44%|████▎     | 43587/100000 [00:07<00:08, 6489.88it/s]  Tokenizando:  44%|████▍     | 44254/100000 [00:07<00:08, 6543.48it/s]  Tokenizando:  45%|████▍     | 44911/100000 [00:07<00:08, 6548.74it/s]  Tokenizando:  46%|████▌     | 45569/100000 [00:07<00:08, 6556.91it/s]  Tokenizando:  46%|████▌     | 46225/100000 [00:07<00:08, 6550.94it/s]  Tokenizando:  47%|████▋     | 46881/100000 [00:07<00:08, 6460.66it/s]  Tokenizando:  48%|████▊     | 47559/100000 [00:07<00:08, 6552.34it/s]  Tokenizando:  48%|████▊     | 48215/100000 [00:08<00:07, 6543.11it/s]  Tokenizando:  49%|████▉     | 48870/100000 [00:08<00:07, 6532.75it/s]  Tokenizando:  50%|████▉     | 49524/100000 [00:08<00:07, 6534.46it/s]  Tokenizando:  50%|█████     | 50188/100000 [00:08<00:07, 6563.47it/s]  Tokenizando:  51%|█████     | 50852/100000 [00:08<00:07, 6584.65it/s]  Tokenizando:  52%|█████▏    | 51511/100000 [00:08<00:07, 6088.22it/s]  Tokenizando:  52%|█████▏    | 52148/100000 [00:08<00:07, 6164.65it/s]  Tokenizando:  53%|█████▎    | 52806/100000 [00:08<00:07, 6284.08it/s]  Tokenizando:  53%|█████▎    | 53455/100000 [00:08<00:07, 6343.23it/s]  Tokenizando:  54%|█████▍    | 54119/100000 [00:08<00:07, 6425.22it/s]  Tokenizando:  55%|█████▍    | 54774/100000 [00:09<00:06, 6461.89it/s]  Tokenizando:  55%|█████▌    | 55422/100000 [00:09<00:06, 6447.47it/s]  Tokenizando:  56%|█████▌    | 56068/100000 [00:09<00:06, 6375.92it/s]  Tokenizando:  57%|█████▋    | 56758/100000 [00:09<00:06, 6523.83it/s]  Tokenizando:  57%|█████▋    | 57416/100000 [00:09<00:06, 6539.23it/s]  Tokenizando:  58%|█████▊    | 58095/100000 [00:09<00:06, 6612.02it/s]  Tokenizando:  59%|█████▉    | 58757/100000 [00:09<00:06, 6515.22it/s]  Tokenizando:  59%|█████▉    | 59410/100000 [00:09<00:06, 6380.69it/s]  Tokenizando:  60%|██████    | 60049/100000 [00:09<00:06, 6377.88it/s]  Tokenizando:  61%|██████    | 60688/100000 [00:09<00:06, 6329.78it/s]  Tokenizando:  61%|██████▏   | 61346/100000 [00:10<00:06, 6402.87it/s]  Tokenizando:  62%|██████▏   | 62010/100000 [00:10<00:05, 6467.79it/s]  Tokenizando:  63%|██████▎   | 62658/100000 [00:10<00:05, 6423.64it/s]  Tokenizando:  63%|██████▎   | 63301/100000 [00:10<00:12, 2928.53it/s]  Tokenizando:  64%|██████▍   | 63958/100000 [00:10<00:10, 3517.49it/s]  Tokenizando:  65%|██████▍   | 64613/100000 [00:10<00:08, 4086.61it/s]  Tokenizando:  65%|██████▌   | 65297/100000 [00:11<00:07, 4668.36it/s]  Tokenizando:  66%|██████▌   | 65931/100000 [00:11<00:06, 5052.38it/s]  Tokenizando:  67%|██████▋   | 66589/100000 [00:11<00:06, 5431.34it/s]  Tokenizando:  67%|██████▋   | 67233/100000 [00:11<00:05, 5694.59it/s]  Tokenizando:  68%|██████▊   | 67870/100000 [00:11<00:05, 5878.15it/s]  Tokenizando:  69%|██████▊   | 68504/100000 [00:11<00:05, 5944.24it/s]  Tokenizando:  69%|██████▉   | 69137/100000 [00:11<00:05, 6052.71it/s]  Tokenizando:  70%|██████▉   | 69774/100000 [00:11<00:04, 6142.49it/s]  Tokenizando:  70%|███████   | 70422/100000 [00:11<00:04, 6238.92it/s]  Tokenizando:  71%|███████   | 71083/100000 [00:11<00:04, 6346.67it/s]  Tokenizando:  72%|███████▏  | 71727/100000 [00:12<00:04, 6317.14it/s]  Tokenizando:  72%|███████▏  | 72365/100000 [00:12<00:04, 6310.79it/s]  Tokenizando:  73%|███████▎  | 73016/100000 [00:12<00:04, 6367.98it/s]  Tokenizando:  74%|███████▎  | 73668/100000 [00:12<00:04, 6412.83it/s]  Tokenizando:  74%|███████▍  | 74323/100000 [00:12<00:03, 6451.14it/s]  Tokenizando:  75%|███████▍  | 74970/100000 [00:12<00:03, 6390.70it/s]  Tokenizando:  76%|███████▌  | 75625/100000 [00:12<00:03, 6435.95it/s]  Tokenizando:  76%|███████▋  | 76275/100000 [00:12<00:03, 6454.44it/s]  Tokenizando:  77%|███████▋  | 76927/100000 [00:12<00:03, 6470.35it/s]  Tokenizando:  78%|███████▊  | 77597/100000 [00:12<00:03, 6538.02it/s]  Tokenizando:  78%|███████▊  | 78265/100000 [00:13<00:03, 6580.00it/s]  Tokenizando:  79%|███████▉  | 78924/100000 [00:13<00:03, 6521.40it/s]  Tokenizando:  80%|███████▉  | 79577/100000 [00:13<00:03, 6496.22it/s]  Tokenizando:  80%|████████  | 80248/100000 [00:13<00:03, 6559.28it/s]  Tokenizando:  81%|████████  | 80931/100000 [00:13<00:02, 6632.80it/s]  Tokenizando:  82%|████████▏ | 81595/100000 [00:13<00:02, 6586.51it/s]  Tokenizando:  82%|████████▏ | 82254/100000 [00:13<00:02, 6460.62it/s]  Tokenizando:  83%|████████▎ | 82901/100000 [00:13<00:02, 6439.89it/s]  Tokenizando:  84%|████████▎ | 83583/100000 [00:13<00:02, 6551.12it/s]  Tokenizando:  84%|████████▍ | 84239/100000 [00:13<00:02, 6548.99it/s]  Tokenizando:  85%|████████▍ | 84895/100000 [00:14<00:02, 6521.48it/s]  Tokenizando:  86%|████████▌ | 85548/100000 [00:14<00:02, 6496.45it/s]  Tokenizando:  86%|████████▌ | 86205/100000 [00:14<00:02, 6516.95it/s]  Tokenizando:  87%|████████▋ | 86870/100000 [00:14<00:02, 6554.18it/s]  Tokenizando:  88%|████████▊ | 87529/100000 [00:14<00:01, 6562.06it/s]  Tokenizando:  88%|████████▊ | 88192/100000 [00:14<00:01, 6582.11it/s]  Tokenizando:  89%|████████▉ | 88851/100000 [00:14<00:01, 6560.04it/s]  Tokenizando:  90%|████████▉ | 89508/100000 [00:14<00:01, 6490.21it/s]  Tokenizando:  90%|█████████ | 90174/100000 [00:14<00:01, 6538.97it/s]  Tokenizando:  91%|█████████ | 90829/100000 [00:15<00:01, 6424.56it/s]  Tokenizando:  91%|█████████▏| 91472/100000 [00:15<00:01, 6318.67it/s]  Tokenizando:  92%|█████████▏| 92146/100000 [00:15<00:01, 6441.65it/s]  Tokenizando:  93%|█████████▎| 92791/100000 [00:15<00:01, 6399.79it/s]  Tokenizando:  93%|█████████▎| 93450/100000 [00:15<00:01, 6455.52it/s]  Tokenizando:  94%|█████████▍| 94101/100000 [00:15<00:00, 6470.68it/s]  Tokenizando:  95%|█████████▍| 94749/100000 [00:15<00:00, 6464.90it/s]  Tokenizando:  95%|█████████▌| 95396/100000 [00:15<00:00, 6451.43it/s]  Tokenizando:  96%|█████████▌| 96057/100000 [00:15<00:00, 6498.00it/s]  Tokenizando:  97%|█████████▋| 96722/100000 [00:15<00:00, 6541.38it/s]  Tokenizando:  97%|█████████▋| 97377/100000 [00:16<00:00, 6490.91it/s]  Tokenizando:  98%|█████████▊| 98047/100000 [00:16<00:00, 6552.73it/s]  Tokenizando:  99%|█████████▊| 98703/100000 [00:16<00:00, 6536.86it/s]  Tokenizando:  99%|█████████▉| 99366/100000 [00:16<00:00, 6562.51it/s]  Tokenizando: 100%|██████████| 100000/100000 [00:16<00:00, 6091.13it/s]
/home/jota/tools/paneas-col/train_unimed_lora.py:266: FutureWarning: `tokenizer` is deprecated and will be removed in version 5.0.0 for `Trainer.__init__`. Use `processing_class` instead.
  trainer = Trainer(
No label_names provided for model class `PeftModelForCausalLM`. Since `PeftModel` hides base models input arguments, if label_names is not given, label_names can't be set automatically within `Trainer`. Note that empty label_names list will be used instead.

🎯 Iniciando treinamento LoRA Unimed...

============================================================
🏃 TREINAMENTO UNIMED EM ANDAMENTO
============================================================
Configuração:
  • Cliente: Unimed Natal
  • Épocas: 3
  • Batch size efetivo: 16
  • Learning rate: 0.0002
  • Warmup steps: 100

⏳ Tempo estimado: 3-6 horas

💡 Você verá atualizações a cada 10 steps
============================================================

  0%|          | 0/18750 [00:00<?, ?it/s]Traceback (most recent call last):
  File "/home/jota/tools/paneas-col/train_unimed_lora.py", line 378, in main
    trainer = train_model(model, tokenizer, train_data)
  File "/home/jota/tools/paneas-col/train_unimed_lora.py", line 303, in train_model
    trainer.train()
  File "/home/jota/.local/lib/python3.10/site-packages/transformers/trainer.py", line 2245, in train
    return inner_training_loop(
  File "/home/jota/.local/lib/python3.10/site-packages/transformers/trainer.py", line 2469, in _inner_training_loop
    self.control = self.callback_handler.on_train_begin(args, self.state, self.control)
  File "/home/jota/.local/lib/python3.10/site-packages/transformers/trainer_callback.py", line 506, in on_train_begin
    return self.call_event("on_train_begin", args, state, control)
  File "/home/jota/.local/lib/python3.10/site-packages/transformers/trainer_callback.py", line 556, in call_event
    result = getattr(callback, event)(
AttributeError: 'ProgressCallback' object has no attribute 'on_train_begin'
  0%|          | 0/18750 [00:00<?, ?it/s]

❌ Erro durante treinamento: 'ProgressCallback' object has no attribute 'on_train_begin'

🧹 Memória GPU liberada
